<!DOCTYPE html>
<html lang="en">
    <head>
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.4 -->

    <!-- Title -->
    
    <title>
        
            效率神器之Alfred Workflow | 
        
        一只菜鸡的成长之路
    </title>

    <!-- Meta & Info -->
    <meta charset="utf-8">

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    
    
    
    
    

    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="scnace">
    <meta name="description" content="I thought what I&#39;d do was I&#39;d pretend I was one of those deaf-mutes">
    <meta name="keywords" content="null,workflow">

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="一只菜鸡的成长之路">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://blog.scnace.cc">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="效率神器之Alfred Workflow | 一只菜鸡的成长之路">
    <meta property="og:description" content="I thought what I&#39;d do was I&#39;d pretend I was one of those deaf-mutes">
    <meta property="og:article:tag" content="workflow"> 

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]-->

    <!-- Import CSS & jQuery -->
    
        <link rel="stylesheet" href="/css/material.min.css">
        <link rel="stylesheet" href="/css/style.min.css">
        <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


        <script src="/js/jquery.min.js"></script>
        <script src="/js/queue.js"></script>
    

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    


    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#效率神器之Alfred-Workflow"><span class="post-toc-number">1.</span> <span class="post-toc-text">效率神器之Alfred Workflow</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#简介"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">简介</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Workflow"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">Workflow</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#适用"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">适用</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#正片"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">正片</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#折腾经历"><span class="post-toc-number">1.4.1.</span> <span class="post-toc-text">折腾经历</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#把CMD-APP转换成更方便的Alfred-Workflow"><span class="post-toc-number">1.4.2.</span> <span class="post-toc-text">把CMD APP转换成更方便的Alfred Workflow</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#编译并运行"><span class="post-toc-number">1.4.3.</span> <span class="post-toc-text">编译并运行</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#文件缓存"><span class="post-toc-number">1.4.4.</span> <span class="post-toc-text">文件缓存</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#关于demo的截图-时间戳转换小工具-TS"><span class="post-toc-number">1.4.5.</span> <span class="post-toc-text">关于demo的截图(时间戳转换小工具 TS)</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#结语"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">结语</span></a></li></ol></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        <!-- Custom Thumbnail -->
        <div class="post_thumbnail-custom mdl-card__media mdl-color-text--grey-50" style="background-image:url(https://static.notion-static.com/57fc7138298d4148b9ec05ee16a4012e/_2017-10-02_10.03.12.png)">
    
            <p class="article-headline-p">
                效率神器之Alfred Workflow
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>scnace</strong>
        <span>Oct 02, 2017</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/workflow/">workflow</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=效率神器之Alfred Workflow&url=http://blog.scnace.cc//AlfredWorkflowV3/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                Share to Weibo
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=效率神器之Alfred Workflow&url=http://blog.scnace.cc//AlfredWorkflowV3/index.html&via=scnace" target="_blank">
            <li class="mdl-menu__item">
                Share to Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.scnace.cc//AlfredWorkflowV3/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://blog.scnace.cc//AlfredWorkflowV3/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h1 id="效率神器之Alfred-Workflow"><a href="#效率神器之Alfred-Workflow" class="headerlink" title="效率神器之Alfred Workflow"></a>效率神器之Alfred Workflow</h1><blockquote>
<p>一个Go的Alfred Workflow简单封装库: <a href="https://github.com/scbizu/alfredV3" target="_blank" rel="external">https://github.com/scbizu/alfredV3</a></p>
</blockquote>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>生活在Mac上的工作者肯定对效率神器 <a href="https://www.alfredapp.com/" target="_blank" rel="external">Alfred</a> 不会陌生, 免费版的APP提供了比Spotlight更加友好以及强大的文件搜索和Quick Web Search功能,令人眼前一亮。本文就不对这些功能的操作和演示作过多说明了。本文将要介绍的是Alfred Workflow对开发者及其友好的另一个功能: <strong>Workflow.</strong></p>
<h2 id="Workflow"><a href="#Workflow" class="headerlink" title="Workflow"></a>Workflow</h2><p>Alfred Workflow通过在弹出框中执行输入的命令,从而给出可以操作的各项输出。从这个角度可以认为是Terminal的简化版,让用户更快地通过Alfred提供的脚本或是自定义的脚本来获取自己想要的信息,然后对这些信息(可能是某个网址,某个复杂计算的结果)进行相应的操作(进行跳转或只是复制到剪贴板)。</p>
<h2 id="适用"><a href="#适用" class="headerlink" title="适用"></a>适用</h2><p>  Workflow对那些每天都进行重复工作的电脑使用者来说应该是加速工作的不二之选了。可以把每天必须要进行的操作编写成脚本,亦或是对自己经常使用的APP(包括锁屏/待机等一些系统操作)设置热键。</p>
<h2 id="正片"><a href="#正片" class="headerlink" title="正片"></a>正片</h2><p>   越来越多实用的workflow被 <a href="https://github.com/willfarrell/alfred-workflows" target="_blank" rel="external">awesome alfred</a> 收录,但是一些不常用的workflow还是得自己动手开发,作为一头对造轮子( ~~作死~~ )充满着渴望的猿来说,如果连一个workflow都写不出来的话 那真的是太不酷了。</p>
<p>   于是,我开始探索GitHub,试图找到一些关于alfred workflow的开源代码 和 README。然而,作为一只gopher,这个时候不能扔掉自己的信仰.倒是也有几个用Go写的脚手架,但是 似乎都是基于Alfred2的。Alfred2 和 Alfred3 的区别最大的就是文件解析方式吧。从3开始,Alfred Workflow 开始支持json作为result的解析方式。 这对打算用Go来重写的我来说,无疑是一个极好的消息,由于之前跟某国企对接的时候,接口要用SOAP来交互,所以就必须用到XML,这时候被Go的 <a href="https://github.com/golang/go/issues/20953" target="_blank" rel="external">一个很奇怪的issue</a> (有点久远 但类似这个)折磨过,虽然最后还是折腾出了 <a href="https://github.com/scbizu/go-soap" target="_blank" rel="external">这货</a> ,但是,过程异常痛苦。所以 就打算以后只要有后退的余地,就坚决不用XML数据格式来encode数据。</p>
<h3 id="折腾经历"><a href="#折腾经历" class="headerlink" title="折腾经历"></a>折腾经历</h3><p>在粗略阅读了 <a href="https://www.alfredapp.com/help/workflows/#creating" target="_blank" rel="external">Alfred Workflow的Document</a> 之后,就开始动手改造之前的cmd app,但是屡屡失败。</p>
<ul>
<li>失败#01:</li>
</ul>
<p>参考了 <a href="https://github.com/liberize/alfred-dict-workflow" target="_blank" rel="external">一个GitHub上高Star的一个workflow</a> ,于是就觉得workflow的交互应该就是 调用一个二进制程序 然后把output输出到弹出的面板上。在workflow里按照Document和参考demo编写好Shell后 输入关键字 然后什么都没有发生。。。。</p>
<ul>
<li>失败#02:</li>
</ul>
<p>又仔细阅读了一下Document里面关于 <a href="https://www.alfredapp.com/help/workflows/inputs/script-filter/" target="_blank" rel="external">Script Filter</a> 的描述之后,开始意识到面板中输出的需要经过decode.看了一遍Document里提到的属性后,嗯,果然,还是什么都不知道。但还是先把能用的属性封装成了一个能看的结构体。
  <figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//AlfredJSONFormat defines the standard `Script Filter JSON Format`</span></div><div class="line"><span class="comment">//more details are mentioned below:</span></div><div class="line"><span class="comment">//https://www.alfredapp.com/help/workflows/inputs/script-filter/json/</span></div><div class="line"><span class="keyword">type</span> AlfredJSONFormat <span class="keyword">struct</span> &#123;</div><div class="line">	Items []*AlfredJSONItem <span class="string">`json:"items"`</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//AlfredJSONItem defines a single item</span></div><div class="line"><span class="keyword">type</span> AlfredJSONItem <span class="keyword">struct</span> &#123;</div><div class="line">	UID <span class="keyword">string</span> <span class="string">`json:"uid"`</span></div><div class="line">	Title <span class="keyword">string</span> <span class="string">`json:"title"`</span></div><div class="line">	SubTitle <span class="keyword">string</span> <span class="string">`json:"subtitle"`</span></div><div class="line">	Arg <span class="keyword">string</span> <span class="string">`json:"arg"`</span></div><div class="line">	Icon *Icon <span class="string">`json:"icon"`</span></div><div class="line">	Valid <span class="keyword">bool</span> <span class="string">`json:"valid"`</span></div><div class="line">	AC <span class="keyword">string</span> <span class="string">`json:"autocomplete"`</span></div><div class="line">	Type <span class="keyword">string</span> <span class="string">`json:"type"`</span></div><div class="line">	Mods *Mods <span class="string">`json:"mods"`</span></div><div class="line">	Text *Text <span class="string">`json:"text"`</span></div><div class="line">	QuickLook <span class="keyword">string</span> <span class="string">`json:"quicklookurl"`</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//Icon defines icon object</span></div><div class="line"><span class="keyword">type</span> Icon <span class="keyword">struct</span> &#123;</div><div class="line">	Type <span class="keyword">string</span> <span class="string">`json:"type"`</span></div><div class="line">	Path <span class="keyword">string</span> <span class="string">`json:"path"`</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//Mods defines mod object</span></div><div class="line"><span class="keyword">type</span> Mods <span class="keyword">struct</span> &#123;</div><div class="line">	Alt ModOptions <span class="string">`json:"alt"`</span></div><div class="line">	Cmd ModOptions <span class="string">`json:"cmd"`</span></div><div class="line">	Ctrl ModOptions <span class="string">`json:"ctrl"`</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//ModOptions defines the extra option in mod</span></div><div class="line"><span class="keyword">type</span> ModOptions <span class="keyword">struct</span> &#123;</div><div class="line">	Valid <span class="keyword">bool</span> <span class="string">`json:"valid"`</span></div><div class="line">	Arg <span class="keyword">string</span> <span class="string">`json:"arg"`</span></div><div class="line">	Subtitle <span class="keyword">string</span> <span class="string">`json:"subtitle"`</span></div><div class="line">	Icon Icon <span class="string">`json:"icon"`</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//Text defines the text option</span></div><div class="line"><span class="keyword">type</span> Text <span class="keyword">struct</span> &#123;</div><div class="line">	Copy <span class="keyword">string</span> <span class="string">`json:"copy"`</span></div><div class="line">	LargeType <span class="keyword">string</span> <span class="string">`json:"largetype"`</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>看到希望的失败#03:</li>
</ul>
<p>这时候开始处理一些Demo Workflow的bug,偶然发现了一个类似浏览器Console的Workflow Debug Console,这个东西还真是对开发者友好啊。</p>
<p>  <img src="https://static.notion-static.com/bf06f21d9eae45b581ef5383390914a8/_2017-10-01_5.06.13.png" alt=""></p>
<p>  根据这个来快速定位Bug还是高效的XD</p>
<h3 id="把CMD-APP转换成更方便的Alfred-Workflow"><a href="#把CMD-APP转换成更方便的Alfred-Workflow" class="headerlink" title="把CMD APP转换成更方便的Alfred Workflow"></a>把CMD APP转换成更方便的Alfred Workflow</h3><blockquote>
<p>VIM玩家请无视我</p>
</blockquote>
<p>  写着Workflow的时候 就在想需要一个通用的方法把自己之前的cmd app 无缝迁到Workflow,于是写了一个很Low的方法:
  <figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Format convert the raw std output into Alfred-formatted output</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(al *AlfredMsg)</span> <span class="title">Format</span><span class="params">()</span></span> &#123;</div><div class="line">	items := <span class="built_in">new</span>(AlfredJSONFormat)</div><div class="line">	<span class="keyword">for</span> _, output := <span class="keyword">range</span> al.rawMsg &#123;</div><div class="line">		item := <span class="built_in">new</span>(AlfredJSONItem)</div><div class="line">		item.Title = output</div><div class="line">		item.Arg = output</div><div class="line">		<span class="comment">// item.UID = ""</span></div><div class="line">		text := <span class="built_in">new</span>(Text)</div><div class="line">		text.Copy = item.Title</div><div class="line">		text.LargeType = item.Title</div><div class="line">		item.Valid = <span class="literal">true</span></div><div class="line">		item.Text = text</div><div class="line">		items.Items = <span class="built_in">append</span>(items.Items, item)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	res, err := json.Marshal(items)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		log.Fatalln(err)</div><div class="line">	&#125;</div><div class="line">	al.output = <span class="keyword">string</span>(res)</div><div class="line">	<span class="keyword">return</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>  上面代码的大概意思就是 就是把output放在面板中的一行中显示出来,并标记它是可以有效的且是可以被选中复制的(copy字段的内容就是该行被 <code>⌘+C</code> 之后可以被粘贴到剪贴板的内容)。这大概就可以勉强符合自己的预期效果了。</p>
<h3 id="编译并运行"><a href="#编译并运行" class="headerlink" title="编译并运行"></a>编译并运行</h3><p>  得益于Go方便的二进制编译，在 <code>go build</code> 之后把生成的二进制文件扔到你创建的Workflow目录下, <strong>注意这是非常关键的一步, 找不到自己新建的Workflow的目录的话,可以在Workflow 目录右击你的Workflow来查看:</strong></p>
<p>  <img src="https://static.notion-static.com/4d8e95f211db4317921729973fb5899f/_2017-10-02_1.11.41.png" alt=""></p>
<p>  然后把二进制程序扔进去就好了。当然,是不是通过二进制程序触发还得看Shell怎么写,像Python这样的脚本语言 就只要把 <code>xxx.py</code> 扔进去就可以了,也就是说Workflow Script Filter Shell环境的 <strong>当前目录</strong> 就是 这个Workflow在Finder里面的目录。(当然还是觉得 <code>Open in Terminal</code> 比较方便)。</p>
<h3 id="文件缓存"><a href="#文件缓存" class="headerlink" title="文件缓存"></a>文件缓存</h3><p>  说起Go的文件缓存,还是偏爱 <a href="https://github.com/boltdb/bolt" target="_blank" rel="external">bolt</a> 。于是就用bolt作为了Workflow的文件缓存。参考着前辈们的demo改造了一下缓存,先来大概说一下Workflow里是怎么玩文件缓存的:
  <figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> (</div><div class="line">	<span class="comment">//CacheDir ...</span></div><div class="line">	CacheDir = <span class="string">"Library/Caches/com.runningwithcrayons.Alfred-3/Workflow Data/"</span></div><div class="line">	<span class="comment">//InfoFile ...</span></div><div class="line">	InfoFile = <span class="string">"info.plist"</span></div><div class="line">	<span class="comment">//</span></div><div class="line">	defaultExpireTime = <span class="number">24</span> * time.Hour</div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</div><div class="line">	rootPath, err := os.Getwd()</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		log.Fatalln(err)</div><div class="line">	&#125;</div><div class="line">	rootInfoPath := path.Join(rootPath, InfoFile)</div><div class="line">	<span class="keyword">if</span> _, err = os.Stat(rootInfoPath); os.IsNotExist(err) &#123;</div><div class="line">		log.Fatalln(err)</div><div class="line">	&#125;</div><div class="line">	info, err := ioutil.ReadFile(rootInfoPath)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		log.Fatalln(err)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">var</span> infoData InfoPlist</div><div class="line">	infoBuf := bytes.NewReader(info)</div><div class="line">	decoder := plist.NewDecoder(infoBuf)</div><div class="line">	err = decoder.Decode(&amp;infoData)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		log.Fatalln(err)</div><div class="line">	&#125;</div><div class="line">	cachePath = os.Getenv(<span class="string">"alfred_workflow_cache"</span>)</div><div class="line">	<span class="keyword">if</span> cachePath == <span class="string">""</span> &#123;</div><div class="line">		cachePath = path.Join(rootPath, CacheDir, infoData.Bundleid)</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//init db</span></div><div class="line">	initDB()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>  从代码中很容易就可以看出来 在找到cache目录之后 文件缓存怎么玩全看开发者自己的操作了。找cache目录其实是个比较麻烦的过程,Alfred在安装时会默认设置 <code>alfred_workflow_cache</code> 的值,从系统变量里是可以获取的到的,但是Alfred安装时也可以不指定这个变量 这就会导致这个变量是个空值。所以,就只能通过workflow下的 <code>info.plist</code> 来手动拼接Cache目录。</p>
<p>  至于实现那就很简单了,我指定了缓存过期的时间,在缓存过期之前,搜索的key都会被映射至其对应的value.为了方便,我给expire的值单独开了一个bucket,这样就可以实现同key不同value的Set/Get了。</p>
<p>  Cache可以用在需要运算时间 并且值也不会经常改变的场景。通过 <code>StroreData</code> 缓存映射结果集:</p>
<pre><code>//Cache defines cache object
type Cache struct {
    Expire int64
    Res []string
    Input string
}
</code></pre><p>  然后 通过 <code>FetchData</code> 用Input来获取之前计算过的Result。</p>
<h3 id="关于demo的截图-时间戳转换小工具-TS"><a href="#关于demo的截图-时间戳转换小工具-TS" class="headerlink" title="关于demo的截图(时间戳转换小工具 TS)"></a>关于demo的截图(时间戳转换小工具 TS)</h3><ul>
<li>两个模式(时间戳转换成多种格式的日期格式/特定日期格式转换成时间戳):</li>
</ul>
<p><img src="https://static.notion-static.com/57fc7138298d4148b9ec05ee16a4012e/_2017-10-02_10.03.12.png" alt=""></p>
<ul>
<li>特定日期格式转换成时间戳:</li>
</ul>
<p><img src="https://static.notion-static.com/b93049627ca34effbdd6bdd0b4c83a06/_2017-10-02_10.03.57.png" alt=""></p>
<ul>
<li>时间戳转换成多种格式的日期格式:</li>
</ul>
<p><img src="https://static.notion-static.com/c6e23e234a8c4eb2938437394773d092/_2017-10-02_10.03.38.png" alt=""></p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>  关于Workflow 其实还是有很多不少地方值得折腾 看上文看得出来 这边基本是关于Script Filter的折腾日记 关于其他的Action 我还是会继续折腾: ) 也会陆续更新在这个repo里面 希望它可以帮到更多人提高工作效率 减少重复工作带来的困扰。</p>
<blockquote>
<p>以上。</p>
</blockquote>

    

    
</div>


                

                <!-- Post Comments -->
                
                    




    <!-- 使用 DISQUS -->
    <div id="disqus-comment">
        <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
        this.page.url = 'http://blog.scnace.cc/AlfredWorkflowV3/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://blog.scnace.cc/AlfredWorkflowV3/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    queue.offer(function() {
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document;
                var s = d.createElement('script');
                s.src = '//blog-scnace-cc.disqus.com/embed.js';
                s.setAttribute('data-timestamp', + new Date());
                (d.head || d.body).appendChild(s);
            })();
        });
</script>

    </div>
    <style>
        #disqus-comment{
            background-color: #eee;
            padding: 2pc;
        }
    </style>




                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/oneplus5-with-oxygen/" id="post_nav-older" class="next-content">
            Older
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="scnace's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        scbizu@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                Home
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    Archives
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/10/">October 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">June 2017<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">May 2017<span class="sidebar_archives-count">44</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                Categories
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/伪技术相关/">#伪技术相关<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/伪技术相关/JAVA-WEB/">JAVA WEB<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Crawler/">Crawler<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/伪情感相关/">伪情感相关<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/伪技术相关/">伪技术相关<span class="sidebar_archives-count">31</span></a></li><li><a class="sidebar_archives-link" href="/categories/伪技术相关/golang/">golang<span class="sidebar_archives-count">15</span></a></li><li><a class="sidebar_archives-link" href="/categories/伪技术相关/php/">php<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/伪技术相关/ssh/">ssh<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/伪技术相关/年度总结/">年度总结<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/伪技术相关/算法/">算法<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/伪技术相关/算法/工作点滴/">工作点滴<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/伪极客/">伪极客<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/伪生活相关/">伪生活相关<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/伪生活相关/情感/">情感<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/伪运维相关/">伪运维相关<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/情感/">情感<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/折腾/">折腾<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/重要课程/">重要课程<span class="sidebar_archives-count">2</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/links/" title="Links">
                
                    <i class="material-icons sidebar-material-icons">link</i>
                
                Links
            </a>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            Theme - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/scnace" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.svg);">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/profile.php?id=100009558353664" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-facebook.svg);">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://plus.google.com/110681183080897592246" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-gplus.svg);">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    
        <a href="http://weibo.com/u/5032057249/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-weibo.svg);">
                <span class="visuallyhidden">Weibo</span>
            </button><!--
     --></a>
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://www.github.com/scbizu/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.svg);">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    
        <a href="https://www.zhihu.com/people/ji-si-min/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-zhihu.svg);">
                <span class="visuallyhidden">Zhihu</span>
            </button><!--
     --></a>
    

    <!-- Bilibili -->
    
        <a href="http://space.bilibili.com/11124261/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-bilibili.svg);">
                <span class="visuallyhidden">Bilibili</span>
            </button><!--
     --></a>
    

    <!-- Telegram -->
    
        <a href="https://t.me/scnace" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-telegram.svg);">
                <span class="visuallyhidden">Telegram</span>
            </button><!--
     --></a>
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;一只菜鸡的成长之路
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->

    <script src="/js/lazyload.min.js"></script>
    <script src="/js/js.min.js"></script>



    <script src="/js/nprogress.js"></script>


<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>












    <!-- 使用 DISQUS js 代码 -->
    <script id="dsq-count-scr" src="//blog-scnace-cc.disqus.com/count.js" async></script>





<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->

<script>
    <!-- Offer LazyLoad -->
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    <!-- Start Queue -->
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

                </main>
            </div>
        </body>
    
</html>
